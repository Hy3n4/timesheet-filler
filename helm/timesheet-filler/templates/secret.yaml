{{- if and .Values.email.enabled (not .Values.email.existingSecret) }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "timesheet-filler.fullname" . }}-email-credentials
  labels:
    {{- include "timesheet-filler.labels" . | nindent 4 }}
  {{- with .Values.podAnnotations }}
  annotations:
    {{- toYaml . | nindent 4 }}
  {{- end }}
type: Opaque
data:
  # Common email configuration
  {{- if .Values.email.fromEmail }}
  email-from-address: {{ .Values.email.fromEmail | b64enc | quote }}
  {{- end }}
  {{- if .Values.email.fromName }}
  email-from-name: {{ .Values.email.fromName | b64enc | quote }}
  {{- end }}

  # SendGrid configuration
  {{- if and (eq .Values.email.provider "sendgrid") .Values.email.sendgrid.apiKey }}
  sendgrid-api-key: {{ .Values.email.sendgrid.apiKey | b64enc | quote }}
  {{- end }}

  # AWS SES configuration
  {{- if eq .Values.email.provider "ses" }}
  {{- if .Values.email.ses.accessKeyId }}
  aws-access-key-id: {{ .Values.email.ses.accessKeyId | b64enc | quote }}
  {{- end }}
  {{- if .Values.email.ses.secretAccessKey }}
  aws-secret-access-key: {{ .Values.email.ses.secretAccessKey | b64enc | quote }}
  {{- end }}
  {{- if .Values.email.ses.region }}
  aws-region: {{ .Values.email.ses.region | b64enc | quote }}
  {{- end }}
  {{- end }}

  # OCI Email configuration
  {{- if eq .Values.email.provider "oci" }}
  {{- if .Values.email.oci.configPath }}
  oci-config-path: {{ .Values.email.oci.configPath | b64enc | quote }}
  {{- end }}
  {{- if .Values.email.oci.profileName }}
  oci-profile-name: {{ .Values.email.oci.profileName | b64enc | quote }}
  {{- end }}
  {{- if .Values.email.oci.compartmentId }}
  oci-compartment-id: {{ .Values.email.oci.compartmentId | b64enc | quote }}
  {{- end }}
  {{- if .Values.email.oci.endpointSuffix }}
  oci-endpoint-suffix: {{ .Values.email.oci.endpointSuffix | b64enc | quote }}
  {{- end }}
  {{- end }}

  # MailJet configuration
  {{- if eq .Values.email.provider "mailjet" }}
  {{- if .Values.email.mailjet.apiKey }}
  mailjet-api-key: {{ .Values.email.mailjet.apiKey | b64enc | quote }}
  {{- end }}
  {{- if .Values.email.mailjet.secretKey }}
  mailjet-secret-key: {{ .Values.email.mailjet.secretKey | b64enc | quote }}
  {{- end }}
  {{- end }}

  # Resend configuration
  {{- if and (eq .Values.email.provider "resend") .Values.email.resend.apiKey }}
  resend-api-key: {{ .Values.email.resend.apiKey | b64enc | quote }}
  {{- end }}
{{- end }}
